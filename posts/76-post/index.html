<!DOCTYPE html>
<html class="dark light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    

    
    
    
    <title>
         76. Writing a cooldown mechanism
        
    </title>

        
            <meta property="og:title" content="76. Writing a cooldown mechanism" />
        
     

     
         
     

     
         
    

    
    <link rel="icon" type="image/png" href=&#x2F;icons&#x2F;icon.png />

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">

    
    
        <link href=https://harsh-doshii.github.io/fonts.css rel="stylesheet" />
    

    
    


    

    
    <link rel="alternate" type="application/atom+xml" title="doshi&#x27;s scratchpad" href="https://harsh-doshii.github.io/atom.xml">


    
    
        <link rel="stylesheet" type="text/css" href=https://harsh-doshii.github.io/theme/light.css />
        <link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://harsh-doshii.github.io/theme/dark.css" />
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://harsh-doshii.github.io/main.css />

    

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-170818569-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-170818569-1');
    </script>

    <script async src="https://us.umami.is/script.js" data-website-id="2b0e0e64-98d6-464b-8574-2cb94d848738"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body);"></script>
</head>

<body>
    <div class="content">
        <header>
    <div class="main">
        <a href=https:&#x2F;&#x2F;harsh-doshii.github.io&#x2F;>doshi&#x27;s scratchpad</a>

        <div class="socials">
            
            <a rel="me" href="https:&#x2F;&#x2F;discuss.systems&#x2F;@hdoshi" class="social">
                <img alt=mastodon src="/social_icons/mastodon.svg">
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;harsh-doshi16&#x2F;" class="social">
                <img alt=linkedin src="/social_icons/linkedin.svg">
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;github.com&#x2F;harsh-doshii" class="social">
                <img alt=github src="/social_icons/github.svg">
            </a>
            
        </div>
    </div>

    <nav>
        
        <a href=&#x2F;posts style="margin-left: 0.7em">&#x2F;posts</a>
        
        <a href=&#x2F;about style="margin-left: 0.7em">&#x2F;about</a>
        
        <a href=&#x2F;people style="margin-left: 0.7em">&#x2F;people</a>
        
        <a href=&#x2F;recommendations style="margin-left: 0.7em">&#x2F;recommendations</a>
        

        
        | <a id="dark-mode-toggle" onclick="toggleTheme()" href="javascript:void(0)">
            <img src="/feather/sun.svg" id="sun-icon" style="filter: invert(1);" />
            <img src="/feather/moon.svg" id="moon-icon" />
        </a>
        <script src=https://harsh-doshii.github.io/js/themetoggle.js></script>
        
    </nav>
</header>


        
        
    
<main>
    <article>
        <div class="title">
            
            
    <div class="page-header">
        76. Writing a cooldown mechanism<span class="primary-color" style="font-size: 1.6em">.</span>
    </div>


                <div class="meta">
                    
                        Posted on <time>2024-04-05</time>
                    

                    
                </div>
        </div>

        

        
        
            
        

        <section class="body">
            <p>There are a lot of notifications that are being triggered in short time, which is causing notification spamming. This is in turn causes un-subscription to the SNS. To fix this we need a cool-down/throttling mechanism.</p>
<p>Problem is that this LOC gets hit over 10,000 times in 1 minute, causing email spam (expected) which in turn causes AWS SNS to automatically unsubscribe the members from this email topic (unexpected). This is an AWS policy to protect consumers against the spma. LOC:</p>
<pre data-lang="py" class="language-py "><code class="language-py" data-lang="py">    self._sns_client.send_notification(self.topic_arn, subject, email)
</code></pre>
<p>I need to write a cooling mechanism, these are my thoughts:</p>
<ol>
<li>
<p>Define a cooldown duration between two consecutive notifications. My target is to execute this LOC from 10,000 times a minute to 1,000 times a minute so I need:
1000 emails --&gt; 60 seconds
1 email --&gt; 0.06 seconds --&gt; 60 ms.
Therefore there should be a cooldown duration of 60 ms between two consecutive emails.</p>
</li>
<li>
<p>Keep a track of current time (ct) (using python libraries) and maintain the time that the last notification (tln) was sent.</p>
</li>
<li>
<p>If current_time - time_since_last_notification &lt; cooldown_duration, we put the thread to sleep: <code>time.sleep(self.cooldown_duration - time_since_last_notification)</code></p>
</li>
<li>
<p>We hit the send_notification LOC as soon as the thread wakes up, and then we update the time_since_last_notification to be the current time.</p>
</li>
</ol>
<p>Note: One thing that you have to be sure of is the unit of cooldown_definition when you define it. Be sure if it is seconds, milli seconds or something else.</p>
<p>This works!</p>

        </section>

        

    </article>
</main>


    </div>
</body>

</html>